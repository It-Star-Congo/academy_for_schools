<head>
    <!-- CSS Tom Select -->
<link href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.css" rel="stylesheet">
<!-- JS Tom Select (build complet avec plugins) -->
<script src="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/js/tom-select.complete.min.js"></script>

</head>
<main class="form-container">
    <h2>Ajouter un nouveau cours</h2>

    <form action="/courses/add" method="POST" enctype="multipart/form-data">
        <div class="form-group">
            <label for="name">Nom du cours :</label>
            <input type="text" id="name" name="name" required>
        </div>

        <div class="form-group">
            <label for="description">Description :</label>
            <textarea id="description" name="description" rows="3"></textarea>
        </div>

        <div class="form-group">
            <label for="teacher">Nom du Titulaire (Mettez votre Username si voulez etre titulaire) :</label>
            <select name="teacher" id="teacher" required>
            <option value="">Aucun
                 </option>
            <% teachers.forEach(teacher => { %>
                <option value="<%= teacher.username %>"><%= teacher
                    .name %> <%= teacher.firstname %></option>
            <% }); %>
            </select>
        </div>

        <div class="form-group">
            <label for="teachers">Nom des Enseignants secondaires (optionnel) :</label>
            <select id="teachers" name="teachers[]" multiple placeholder="Sélectionner un ou plusieurs enseignants…">
                <% teachers.forEach(t => { %>
                <option
                    value="<%= t.id %>"
                    <%= Array.isArray(selectedTeachers) && selectedTeachers.map(String).includes(String(t.id)) ? 'selected' : '' %>
                >
                    <%= t.name %> <%= t.firstname %>
                </option>
                <% }) %>
            </select>
        </div>


        <div class="form-group">
            <label for="price">Prix du cours :</label>
            <input type="text" id="price" name="price" required>
        </div>

        <div class="form-group">
            <label for="classId">Classe associée :</label>
            
            <select name="course" id="course" required>
            <option value="">Sélectionner une classe</option>
            <% classes.forEach(classe => { %>
                <option value="<%= classe.id %>"><%= classe.name %></option>
            <% }); %>
            </select>
        </div>

        <div class="form-group">
            <label for="image">Image du cours :</label>
            <input type="file" id="image" name="image" accept="image/*">
        </div>

        <div class="form-group">
            <label for="documents">Fichiers du cours (PDF, MP3, MP4, etc.) :</label>
            <div id="files-container">
                <div class="file-group">
                    <input type="text" name="documentNames[]" placeholder="Nom du fichier (ex : Syllabus)" required>
                    <input type="file" name="documents" required>
                </div>
            </div>
            <button type="button" onclick="addFileGroup()">Ajouter un fichier</button>
        </div>

        <div class="form-group">
            <button type="submit" class="btn-submit">Ajouter le cours</button>
        </div>
    </form>
    <script>
    function addFileGroup() {
    const container = document.getElementById('files-container');
    const div = document.createElement('div');
    div.classList.add('file-group');
    div.innerHTML = `
        <input type="text" name="documentNames[]" placeholder="Nom du fichier (ex : Syllabus)" required>
        <input type="file" name="documents" required>
    `;
    container.appendChild(div);
    }
    </script>

    <script>
document.addEventListener('DOMContentLoaded', () => {
  new TomSelect('#teachers', {
    plugins: {
      checkbox_options: {},        // ✅ cases à cocher dans la liste
      remove_button: { title: 'Retirer' } // petite croix sur les tags sélectionnés
    },
    maxItems: null,                // pas de limite
    closeAfterSelect: false,       // reste ouvert pour cocher plusieurs
    allowEmptyOption: true,
    placeholder: 'Sélectionner un ou plusieurs enseignants…',
    render: {
      // Optionnel : affiche proprement les labels dans le dropdown
      option: (data, escape) => `<div>${escape(data.text)}</div>`
    }
  });
});
</script>


</main>
