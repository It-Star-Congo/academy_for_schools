<div class="container">
    <h1>Ajouter un Exercice</h1>
    <form action="/exercise/add" method="POST" class="exercise-form">
        
        <label for="title">Titre :</label>
        <input type="text" name="title" id="title" placeholder="Titre de l'exercice" required>

        <label for="course">Cours :</label>
        <select name="course" id="course" required>
            <option value="">Sélectionner un cours</option>
            <% courses.forEach(course => { %>
                <option value="<%= course.id %>"><%= course.name %></option>
            <% }); %>
        </select>

        <label for="author">Autheur :</label>
        <input type="text" name="author" id="author" placeholder="Auteur" required>

        <label for="type">Type :</label>
        <select name="type" id="type" onchange="toggleFields()">
            <option value="vide">Choisir un type</option>
            <option value="qcm">QCM</option>
            <option value="texte_trous">Texte à trous</option>
            <option value="programmation">Programmation</option>
            <option value="redaction">Rédaction</option>
            <option value="file">Fichier à rendre</option>
        </select>

        <label for="description">Description :</label>
        <textarea name="description" id="description" placeholder="Description de l'exercice" required></textarea>

        <label for="description">Poids de la note:</label>
        <input type="number" name="poid" id="poid" placeholder="Entre 0.0 et 2.0" min="0" max="2" step="0.01" required>

        <%= if (abonnement == "pro") { %>
            <label for="price">Prix du cours</label>
            <input type="number" name="price" id="price" placeholder="Le montant du prix du cours (en Dollars)" min="0" max="20 000" step="0.5" required>
        <%= } %>

        <label for="solution">Solution :</label>
        <textarea name="solution" id="solution" placeholder="Solution attendue (si applicable)"></textarea>

        <!-- Champs spécifiques à la programmation -->
        <div id="programmingFields" style="display:none;">
            <label for="starterCode">Code de départ :</label>
            <textarea name="starterCode" id="starterCode" placeholder="Code de départ (si applicable)"></textarea>

            <label for="expectedOutput">Sortie attendue :</label>
            <textarea name="expectedOutput" id="expectedOutput" placeholder="Sortie attendue (si applicable)"></textarea>

            <label for="testCases">Test Cases (JSON) :</label>
            <textarea name="testCases" id="testCases" placeholder='[{"input": "1,2", "output": "3"}]'></textarea>
        </div>

        <!-- Champs spécifiques au QCM -->
        <div id="qcmFields" style="display:none;">
            <div id="questionsWrapper">
                <div class="questionBlock">
                    <label for="questions">Question 1 :</label>
                    <input type="text" name="questions[0][question]" placeholder="Question">
                    
                    <label for="options">Options :</label>
                    <textarea name="questions[0][options]" placeholder="Ex: Option1, Option2, Option3" ></textarea>
                    
                    <label for="correctAnswer">Réponse correcte :</label>
                    <input type="text" name="questions[0][correctAnswer]" placeholder="Réponse correcte">
                </div>
            </div>
            <button type="button" onclick="addQuestion()">Ajouter une question</button>
        </div>

        <!-- Champs spécifiques à la rédaction -->
        <div id="essayFields" style="display:none;">
            <label for="evaluationCriteria">Critères d'évaluation (JSON) :</label>
            <textarea name="evaluationCriteria" id="evaluationCriteria" placeholder='{"clarté": 5, "argumentation": 5, "orthographe": 5}'></textarea>
        </div>

        <!-- Champs spécifiques au texte à trous -->
        <div id="fillBlanksFields" style="display:none;">
            <label for="textWithBlanks">Texte à trous :</label>
            <textarea name="textWithBlanks" id="textWithBlanks" placeholder="Tapez le texte en remplaçant chaque trou par __"></textarea>

            <label for="blanksAnswers">Réponses aux trous (JSON) :</label>
            <textarea name="blanksAnswers" id="blanksAnswers" placeholder='["réponse1", "réponse2"]'></textarea>
        </div>

        <!-- Champs spécifiques à la soumission de fichiers -->
        <div id="fileFields" style="display:none;">
            <label for="fileType">Type de fichiers :</label>
            <select name="fileType" id="fileType" onchange="toggleAllowedExtensions()">
            <optgroup label="Documents">
                <option value="word">Word (.docx, .doc, .docm, .dotx)</option>
                <option value="pdf">PDF (.pdf)</option>
                <option value="texte">Texte brut (.txt, .md, .rtf)</option>
                <option value="latex">LaTeX (.tex)</option>
            </optgroup>

            <optgroup label="Bureautique">
                <option value="excel">Excel (.xls, .xlsx, .ods, .csv)</option>
                <option value="presentation">PowerPoint (.ppt, .pptx, .odp)</option>
            </optgroup>

            <optgroup label="Programmation">
                <option value="code">Code source (.py, .c, .cpp, .java, .js, .html, .css, .php, .sql)</option>
                <option value="notebook">Jupyter Notebook (.ipynb)</option>
            </optgroup>

            <optgroup label="Autres">
                <option value="image">Images (.png, .jpg, .jpeg, .gif, .svg)</option>
                <option value="media">Audio / Vidéo (.mp3, .wav, .mp4, .mov)</option>
                <option value="archive">Archives (.zip, .rar, .tar, .gz, .7z)</option>
                <option value="all" selected>Tous types</option>
            </optgroup>
            </select>

            <br><br>


            <label for="fileSize">Taille maximale (en Mo) :</label>
            <input 
            type="number" 
            id="fileSize" 
            name="fileSize" 
            min="1" 
            max="20" 
            step="1" 
            placeholder="Ex: 10" 
            required
            >
            <small>Entrez la taille maximale autorisée (par exemple 10 pour 10 Mo)</small>

            <label for="allowedExtensions">Extensions autorisées :</label>
            <input 
            type="text" 
            id="allowedExtensions" 
            name="allowedExtensions" 
            placeholder="Sélectionnez un type pour voir les extensions"
            readonly
            style="width: 100%; background: #f8f8f8; cursor: not-allowed;"
            >


        </div>

        <button type="submit" class="btne0">Ajouter</button>
    </form>
</div>

<style>
.container {
    max-width: 800px;
    margin: auto;
    background: white;
    padding: 20px;
    border-radius: 5px;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
}

.exercise-form {
    display: flex;
    flex-direction: column;
}

label {
    font-weight: bold;
    margin-top: 10px;
}

input, textarea, select {
    width: 100%;
    padding: 10px;
    margin: 5px 0;
    border-radius: 5px;
    border: 1px solid #ddd;
}

.btne0 {
    background: #007bff;
    color: white;
    padding: 10px;
    border: none;
    cursor: pointer;
    margin-top: 15px;
    border-radius: 5px;
}

.btne0:hover {
    background: #0056b3;
}
</style>

<script>
function toggleFields() {
    const type = document.getElementById('type').value;
    console.log("Type sélectionné :", type);
    document.getElementById('programmingFields').style.display = (type === 'programmation') ? 'block' : 'none';
    document.getElementById('qcmFields').style.display = (type === 'qcm') ? 'block' : 'none';
    document.getElementById('essayFields').style.display = (type === 'redaction') ? 'block' : 'none';
    document.getElementById('fillBlanksFields').style.display  = (type === 'texte_trous') ? 'block' : 'none';
    document.getElementById('fileFields').style.display  = (type === 'file') ? 'block' : 'none';
}

// Fonction pour ajouter une nouvelle question au QCM
function addQuestion() {
    const questionCount = document.querySelectorAll('.questionBlock').length;
    const questionWrapper = document.getElementById('questionsWrapper');
    
    const newQuestionBlock = document.createElement('div');
    newQuestionBlock.classList.add('questionBlock');
    
    newQuestionBlock.innerHTML = `
        <label for="questions">Question ${questionCount + 1} :</label>
        <input type="text" name="questions[${questionCount}][question]" placeholder="Question">
        
        <label for="options">Options :</label>
        <textarea name="questions[${questionCount}][options]" placeholder="Ex: Option1, Option2, Option3" required></textarea>
        
        <label for="correctAnswer">Réponse correcte :</label>
        <input type="text" name="questions[${questionCount}][correctAnswer]" placeholder="Réponse correcte" required>
    `;
    
    questionWrapper.appendChild(newQuestionBlock);
}
</script>

<script>
function toggleAllowedExtensions() {
  const type = document.getElementById("type").value;
  const display = document.getElementById("allowedExtensions");
  let allowed = "";

  switch (type) {
    case "word":
      allowed = ".doc,.docx,.docm,.dotx";
      break;
    case "pdf":
      allowed = ".pdf";
      break;
    case "texte":
      allowed = ".txt,.md,.rtf";
      break;
    case "latex":
      allowed = ".tex";
      break;
    case "excel":
      allowed = ".xls,.xlsx,.ods,.csv";
      break;
    case "presentation":
      allowed = ".ppt,.pptx,.odp";
      break;
    case "code":
      allowed = ".py,.c,.cpp,.java,.js,.html,.css,.php,.sql,.json,.xml";
      break;
    case "notebook":
      allowed = ".ipynb";
      break;
    case "image":
      allowed = ".png,.jpg,.jpeg,.gif,.svg,.bmp";
      break;
    case "media":
      allowed = ".mp3,.wav,.mp4,.mov,.avi,.mkv";
      break;
    case "archive":
      allowed = ".zip,.rar,.tar,.gz,.7z";
      break;
    case "all":
    default:
      allowed = ""; // autorise tout
      break;
  }

  // Met à jour l’attribut accept de l’input
  display.value = allowed;
}
</script>

